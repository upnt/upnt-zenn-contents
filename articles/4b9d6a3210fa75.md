---
title: "conanã‚’ä½¿ã£ã¦Makefileã®ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ãƒ‘ã‚¹(-I)ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‘ã‚¹(-L)ã‚’è§£æ±ºã™ã‚‹"
emoji: "ğŸ˜½"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["cpp", "conan", "Makefile"]
published: true
---

# ã¯ã˜ã‚ã«

Conanã¯C++ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç®¡ç†ã§ãã‚‹éå¸¸ã«å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚Makefileã«ã‚‚å®Œå…¨ã«å¯¾å¿œã—ã¦ã„ã¦CMakeãŒè‹¦æ‰‹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚‚ä¾¿åˆ©ã«ä½¿ãˆã¾ã™ã€‚
@[card](https://conan.io)

å…¬å¼ã‚µã‚¤ãƒˆã«ã‚‚æ›¸ã‹ã‚Œã¦ã„ã‚‹å†…å®¹ã§ã™ãŒã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«åˆã‚ã›ã¦å…·ä½“çš„ãªä½¿ã„æ–¹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚ä¸»ã«ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚
@[card](https://docs.conan.io/2/integrations/makefile.html)
@[card](https://docs.conan.io/2/reference/tools/gnu/makedeps.html#conan-tools-gnu-makedeps)

ã¨ã‚Šã‚ãˆãšå‹•ã‹ã—ãŸã„ã£ã¦äººã¯ã€Œ[ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé›†](#ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé›†)ã€ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ãŠè©¦ã—ãã ã•ã„ã€‚

# Conan + Makefileã®åŸºæœ¬çš„ãªä½¿ã„æ–¹

## 1. conanfile.txtã‚’æ›¸ã“ã†

Conan + Makefileã‚’ä½¿ã†å ´åˆã€`conanfile.txt`ã‚’`Makefile`ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç½®ãã¾ã™ã€‚

```bash
- conanfile.txt
- Makefile
- src/
  | - main.cpp
  | - module.hpp
  | - module.cpp etc.
```

ã‚ã‚‹ã„ã¯æ¬¡ã®ã‚ˆã†ãªæ§‹é€ ã§ã‚‚OKã§ã™ã€‚

```bash
- conanfile.txt
- Makefile
- main.cpp
- src/
  | - module.cpp etc.
- header/
  | - module.hpp etc.
```

`conanfile.txt`ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨˜è¼‰ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ä¾‹ãˆã°ã“ã‚“ãªæ›¸ãæ–¹ã«ãªã‚Šã¾ã™ã€‚

```ini
[requires]
boost/1.87.0
onetbb/2021.13.0

[generators]
MakeDeps
```

- requires: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›¸ãã¨ã“ã‚
- generators: ç”Ÿæˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ã‚’æ›¸ãã¨ã“ã‚ã€‚ã“ã“ã§ã¯ã„ã£ãŸã‚“MakeDepsã§ã‚ªãƒƒã‚±ãƒ¼ã§ã™

## 2. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†

`conanfile.txt`ã‚’ç½®ã„ãŸã‚‰ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚

```bash
conan install . --build=missing --output-folder=conan
```

ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ„å‘³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- build: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«ã©ã†ã‚„ã£ã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‹ã‚’æŒ‡å®šã€‚"missing"ã«ã™ã‚‹ã¨ã‚½ãƒ¼ã‚¹ã‹ã‚‰è‡ªå‹•ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚
- output-folder: ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆå…ˆã‚’æŒ‡å®šã€‚ä»Šå›ã¯`conan/`ã¨ã„ã†åå‰ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”Ÿæˆã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šä¾å­˜ãƒ•ã‚¡ã‚¤ãƒ«ãŒ`~/.conan2/`ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€åŒæ™‚ã«æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```bash
conan/conandeps.mk
```

ã“ã®`.mk`ã‚’`Makefile`ã§èª­ã¿è¾¼ã‚€ã ã‘ã§ã€ç°¡å˜ã«includeãƒ‘ã‚¹ã‚„libãƒ‘ã‚¹ã‚’è‡ªå‹•ã§è§£æ±ºã—ã¦ãã‚Œã¾ã™ã€‚

:::message
ã“ã“ã§ã¯`conandeps.mk`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸãŒã€ã“ã‚Œã¯generatorã«MakeDepsã‚’è¨­å®šã—ãŸãŸã‚ã§ã™ã€‚ä¾‹ãˆã°AutotoolsDepsã‚’æŒ‡å®šã™ã‚‹ã¨LDFLAGSã¨ã‹ã‚’exportã™ã‚‹ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ`conanautotoolsdeps.sh`ã‚’ä½œã£ã¦ãã‚Œã¾ã™ã€‚
ã•ã‚‰ã«ã¯ã“ã®generatorã¯è¤‡æ•°æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã€ãŸã¨ãˆã° MakeDeps ã¨ AutotoolsDeps ã‚’åŒæ™‚ã«ç”Ÿæˆã—ã€å¿…è¦ã«å¿œã˜ã¦ conanautotoolsdeps.sh ã‚’ source ã—ã¦ä½¿ã†ã€ã¨ã„ã†é‹ç”¨ã‚‚ã§ãã¾ã™ã€‚
generatorã‚’è‰²ã€…è©¦ã—ã¦ã¿ã‚‹ã®ã‚‚é¢ç™½ã„ã¨æ€ã„ã¾ã™ã€‚
:::

## 3. Makefileã‹ã‚‰conandeps.mkã‚’èª­ã¿è¾¼ã‚€

ä½¿ã„æ–¹ã¯ã¨ã¦ã‚‚ç°¡å˜ã§ã€Makefile ã®å…ˆé ­ã«æ¬¡ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã™ã€‚

```Makefile
include conandeps.mk
```

ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ãŒMakefileã«èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚

| å¤‰æ•°                 | å†…å®¹                                      |
| -------------------- | ----------------------------------------- |
| `CONAN_INCLUDE_DIRS` | `/path/to/include` ã®ãƒªã‚¹ãƒˆ               |
| `CONAN_LIB_DIRS`     | `/path/to/lib` ã®ãƒªã‚¹ãƒˆ                   |
| `CONAN_LIBS`         | `boost_program_options`ãªã©ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå |

ä¾‹ãˆã°ã€å®Ÿéš›ã®`CONAN_INCLUDE_DIRS`ã¯ã“ã‚“ãªæ„Ÿã˜ã«ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ãƒ‘ã‚¹ãŒä¸¦ã‚“ã§ã„ã¾ã™ã€‚

```
/home/upnt/.conan2/p/b/onetb9cd273fcb17be/p/include /home/upnt/.conan2/p/b/hwlocdb3bfb5eea16e/p/include /home/upnt/.conan2/p/b/boost1ecd82564e417/p/include /home/upnt/.conan2/p/b/zlib11cf905ad2bb7/p/include /home/upnt/.conan2/p/b/bzip214aa86f64b388/p/include /home/upnt/.conan2/p/b/libba4a2544804436a/p/include
```

ã“ã‚Œã‚’ä½¿ã£ã¦ã€æœ€å°æ§‹æˆã®`Makefile`ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚

```Makefile
include conan/conandeps.mk

CXX ?= g++
CXXFLAGS += $(addprefix -I,$(CONAN_INCLUDE_DIRS))
LDFLAGS += $(addprefix -L,$(CONAN_LIB_DIRS))
LDLIBS += $(addprefix -l,$(CONAN_LIBS))

%: %.cpp
	$(CXX) $(CXXFLAGS) $< -o $@ $(LDFLAGS) $(LDLIBS)
```

ã“ã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ç°¡å˜ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å°å…¥ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚Œã¡ã‚ƒã„ã¾ã™ï¼ã“ã“ã‹ã‚‰ã¯ã„ãã¤ã‹ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ã‚‚ã¨ã«å…·ä½“çš„ãªä½¿ã„æ–¹ã‚’ç´¹ä»‹ã—ã¾ã—ã‚‡ã†ã€‚

# ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé›†

## 1. Boostã‚’ä½¿ã£ãŸæœ€å°æ§‹æˆ

ã¾ãšã¯ã€Boostä¾å­˜ã®ç°¡å˜ãªã‚µãƒ³ãƒ—ãƒ«ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ:

```
- conanfile.txt
- Makefile
- main.cpp
```

`conanfile.txt`:

```ini
[requires]
boost/1.87.0

[generators]
MakeDeps
```

`Makefile`:

```Makefile
include conan/conandeps.mk

CXX ?= g++
CXXFLAGS += $(addprefix -I,$(CONAN_INCLUDE_DIRS))
LDFLAGS += $(addprefix -L,$(CONAN_LIB_DIRS))
LDLIBS += $(addprefix -l,$(CONAN_LIBS))

%: %.cpp
	$(CXX) $(CXXFLAGS) $< -o $@ $(LDFLAGS) $(LDLIBS)
```

`main.cpp`:

```cpp
#include <boost/program_options.hpp>
#include <iostream>

int main(int argc, char* argv[]) {
    namespace po = boost::program_options;

    po::options_description desc("Options");
    desc.add_options()
        ("help,h", "Show help message")
        ("value,v", po::value<int>(), "Example value");

    po::variables_map vm;
    po::store(po::parse_command_line(argc, argv, desc), vm);
    po::notify(vm);

    if (vm.count("help")) {
        std::cout << desc << "\n";
        return 0;
    }

    if (vm.count("value")) {
        std::cout << "Value = " << vm["value"].as<int>() << "\n";
    }

    return 0;
}
```

conanfile.txt ã« boost ã‚’æ›¸ã„ã¦ã„ã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§boostã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« + main.cppã®ãƒ“ãƒ«ãƒ‰ãŒã§ãã¾ã™ã€‚

```bash
conan install . --build=missing --output-folder=conan
make main
./main --value 42
```

ãŸã£ãŸã®ãƒ•ã‚¡ã‚¤ãƒ«3ã¤ + 3ã‚³ãƒãƒ³ãƒ‰ã§é¢å€’ãªãƒ‘ã‚¹è¨­å®šãªã—ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒå¯èƒ½ã§ã™ã€‚
ç‰¹ã«Boostã¯ã‚ˆãä½¿ã†æ–¹ãŒå¤šã„ã®ã§ã“ã‚Œã ã‘ç°¡å˜ã«è¨­å®šã§ãã‚‹ã®ã¯ã¨ã¦ã‚‚åŠ©ã‹ã‚Šã¾ã™ã€‚

## 2. è¤‡æ•°ã®mainãŒã‚ã‚‹å ´åˆ

å°‘ã—å‡ã£ãŸæ§‹æˆã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°ä½œã‚ŠãŸã„å ´åˆã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ§‹æˆã§ã™ã€‚ç‰¹ã«ä»Šå›ã¯`main1.cpp`ãŒboost_program_optionsã‚’ä½¿ç”¨ã—ã€`main2.cpp`ãŒonetbbã‚’ä½¿ç”¨ã™ã‚‹ã¨ã„ã†ã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆã¾ã™ã€‚

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ:

```
- conanfile.txt
- Makefile
- src/
  - main1.cpp
  - main2.cpp
- build/
  - ã“ã“ã«å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã
```

`conanfile.txt`:

```ini
[requires]
boost/1.87.0
onetbb/2021.13.0

[generators]
MakeDeps
```

`Makefile`:

```Makefile
include conan/conandeps.mk

CXX ?= g++
CXXFLAGS += $(addprefix -I,$(CONAN_INCLUDE_DIRS))
LDFLAGS += $(addprefix -L,$(CONAN_LIB_DIRS))

SRCDIR := src
BINDIR := build
TARGETS := $(BINDIR)/main1 $(BINDIR)/main2

.PHONY: all clean
all: $(BINDIR) $(TARGETS)

$(BINDIR):
	mkdir -p $(BINDIR)

$(BINDIR)/main1: $(SRCDIR)/main1.cpp
	$(CXX) $(CXXFLAGS) $< -o $@ $(LDFLAGS) -lboost_program_options

$(BINDIR)/main2: $(SRCDIR)/main2.cpp
	$(CXX) $(CXXFLAGS) $< -o $@ $(LDFLAGS) -ltbb

clean:
	${RM} -r $(BINDIR)
```

`main1.cpp`: ã€Œ[1. Boostã‚’ä½¿ã£ãŸæœ€å°æ§‹æˆ](#1.-boostã‚’ä½¿ã£ãŸæœ€å°æ§‹æˆ)ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®main.cppã‚’ä½¿ç”¨

`main2.cpp`:

```cpp
#include <oneapi/tbb/parallel_for.h>
#include <iostream>
#include <vector>

int main() {
    std::vector<int> data(10);

    oneapi::tbb::parallel_for(
        std::size_t(0), data.size(),
        [&](std::size_t i) {
            data[i] = static_cast<int>(i * i);
        }
    );

    for (auto x : data) {
        std::cout << x << ' ';
    }
    std::cout << '\n';
}
```

å‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒæ§˜ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§boostã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« + main.cppã®ãƒ“ãƒ«ãƒ‰ãŒã§ãã¾ã™ã€‚

```bash
conan install . --build=missing --output-folder=conan
make
./build/main1 --value 42
./build/main2
```

ã“ã®ã‚ˆã†ã«`conan install`ã¨`make`ã‚³ãƒãƒ³ãƒ‰ã ã‘ã§è¤‡æ•°ã®ãƒã‚¤ãƒŠãƒªãŒä½œã‚Œã¾ã™ã€‚
åŸºæœ¬çš„ã«conanéƒ¨åˆ†ã¯å¤‰æ›´ã›ãšã€`Makefile`ã®ä¸­èº«ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§å¤§æŠµã®ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œå¯èƒ½ã§ã™ã€‚
ãã®ãŸã‚ã€`Makefile`ã«ã¤ã„ã¦ã‚ã‚‹ç¨‹åº¦å‹‰å¼·ã™ã‚‹ã ã‘ã§ã„ã‚ã„ã‚ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿œç”¨ã§ãã¾ã™ã€‚

# ã¾ã¨ã‚

Conanã‚’ä½¿ã†ã“ã¨ã§C++ã«ãŠã‘ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒæ ¼æ®µã¨ã‚ˆããªã‚Šã€ãƒ‘ã‚¹è§£æ±ºã®ãŸã‚ã«æ•°æ™‚é–“ã‚’ç„¡é§„ã«ã™ã‚‹ç”Ÿæ´»ã‹ã‚‰ãŠã•ã‚‰ã°ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚
ä¸€åº¦ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚Œã°å¾Œã¯ç°¡å˜ãªã®ã§ã€æ˜¯éä¸€åº¦è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼çš†ã•ã‚“ã®ãƒãƒƒã‚¯ãƒ©ã‚¤ãƒ•ãŒã‚ˆã‚Šæ¥½ã—ããªã‚‹ã‚ˆã†ãŠç¥ˆã‚Šã„ãŸã—ã¾ã™ã€‚
